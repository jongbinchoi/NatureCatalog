{"version":3,"file":"VDatePickerMonth.mjs","names":["VBtn","useDatePicker","useBackgroundColor","computed","ref","genericComponent","omit","propsFactory","getWeek","toIso","dateEmits","makeDateProps","useDate","makeVDatePickerMonthProps","color","String","showAdjacentMonths","Boolean","hideWeekdays","showWeek","hoverDate","multiple","side","type","min","Number","Date","max","VDatePickerMonth","name","props","emits","date","setup","_ref","emit","slots","adapter","isDragging","dragHandle","hasScrolled","month","displayDate","findClosestDate","dates","isSameDay","getDiff","startDate","endDate","distStart","Math","abs","distEnd","weeksInMonth","weeks","getWeekArray","value","days","flat","daysInMonth","length","lastDay","week","day","push","addDays","validDates","modelValue","filter","v","isRange","today","map","index","isDisabled","isAfter","isStart","isEnd","isAdjacent","isSameMonth","isSame","isoDate","formatted","format","year","getYear","getMonth","isWeekStart","isWeekEnd","isSelected","isToday","isHidden","inRange","isWithinRange","isHovered","inHover","localized","backgroundColorClasses","backgroundColorStyles","selectDate","newModel","slice","otherIndex","fn","find","d","closest","indexOf","undefined","i","isBefore","daysRef","findElement","el","dataset","vDate","parentElement","findDate","e","x","changedTouches","clientX","y","clientY","document","elementFromPoint","canDrag","handleMousedown","selected","modelIndex","findIndex","isEqual","window","addEventListener","handleTouchmove","passive","preventDefault","handleTouchend","over","cancelable","removeEventListener","end","_createVNode","_createTextVNode","getWeekdays","weekDay","item","variant","default"],"sources":["../../../src/labs/VDatePicker/VDatePickerMonth.tsx"],"sourcesContent":["// Styles\nimport './VDatePickerMonth.sass'\n\n// Components\nimport { VBtn } from '@/components/VBtn'\n\n// Composables\nimport { useDatePicker } from './composables'\nimport { useBackgroundColor } from '@/composables/color'\n\n// Utilities\nimport { computed, ref } from 'vue'\nimport { genericComponent, omit, propsFactory } from '@/util'\n\n// Types\nimport { getWeek, toIso } from '../date/date'\nimport { dateEmits, makeDateProps } from '../VDateInput/composables'\nimport { useDate } from '@/labs/date'\n\nexport const makeVDatePickerMonthProps = propsFactory({\n  color: String,\n  showAdjacentMonths: Boolean,\n  hideWeekdays: Boolean,\n  showWeek: Boolean,\n  hoverDate: null,\n  multiple: Boolean,\n  side: {\n    type: String,\n  },\n  min: [Number, String, Date],\n  max: [Number, String, Date],\n\n  ...omit(makeDateProps(), ['inputMode', 'viewMode']),\n}, 'VDatePickerMonth')\n\nexport const VDatePickerMonth = genericComponent()({\n  name: 'VDatePickerMonth',\n\n  props: makeVDatePickerMonthProps({ color: 'surface-variant' }),\n\n  emits: {\n    ...omit(dateEmits, ['update:inputMode', 'update:viewMode']),\n    'update:hoverDate': (date: any) => true,\n  },\n\n  setup (props, { emit, slots }) {\n    const adapter = useDate()\n    const { isDragging, dragHandle, hasScrolled } = useDatePicker()\n\n    const month = computed(() => props.displayDate)\n\n    const findClosestDate = (date: any, dates: any[]) => {\n      const { isSameDay, getDiff } = adapter\n      const [startDate, endDate] = dates\n\n      if (isSameDay(startDate, endDate)) {\n        return getDiff(date, startDate, 'days') > 0 ? endDate : startDate\n      }\n\n      const distStart = Math.abs(getDiff(date, startDate))\n      const distEnd = Math.abs(getDiff(date, endDate))\n\n      return distStart < distEnd ? startDate : endDate\n    }\n\n    // const hoverRange = computed<[any, any] | null>(() => {\n    //   if (!props.hoverDate) return null\n\n    //   const closestDate = findClosestDate(props.hoverDate, props.modelValue)\n\n    //   if (!closestDate) return null\n\n    //   return adapter.isAfter(props.hoverDate, closestDate) ? [closestDate, props.hoverDate] : [props.hoverDate, closestDate]\n    // })\n\n    const weeksInMonth = computed(() => {\n      const weeks = adapter.getWeekArray(month.value)\n\n      const days = weeks.flat()\n\n      // Make sure there's always 6 weeks in month (6 * 7 days)\n      // But only do it if we're not hiding adjacent months?\n      const daysInMonth = 6 * 7\n      if (days.length < daysInMonth && props.showAdjacentMonths) {\n        const lastDay = days[days.length - 1]\n\n        let week = []\n        for (let day = 1; day <= daysInMonth - days.length; day++) {\n          week.push(adapter.addDays(lastDay, day))\n\n          if (day % 7 === 0) {\n            weeks.push(week)\n            week = []\n          }\n        }\n      }\n\n      return weeks\n    })\n\n    const daysInMonth = computed(() => {\n      const validDates = props.modelValue.filter(v => !!v)\n      const isRange = validDates.length > 1\n\n      const days = weeksInMonth.value.flat()\n      const today = adapter.date()\n\n      const startDate = validDates[0]\n      const endDate = validDates[1]\n\n      return days.map((date, index) => {\n        const isDisabled = !!(\n          (props.min && adapter.isAfter(props.min, date)) ||\n          (props.max && adapter.isAfter(date, props.max))\n        )\n        const isStart = startDate && adapter.isSameDay(date, startDate)\n        const isEnd = endDate && adapter.isSameDay(date, endDate)\n        const isAdjacent = !adapter.isSameMonth(date, month.value)\n        const isSame = validDates.length === 2 && adapter.isSameDay(startDate, endDate)\n\n        return {\n          date,\n          isoDate: toIso(adapter, date),\n          formatted: adapter.format(date, 'keyboardDate'),\n          year: adapter.getYear(date),\n          month: adapter.getMonth(date),\n          isDisabled,\n          isWeekStart: index % 7 === 0,\n          isWeekEnd: index % 7 === 6,\n          isSelected: isStart || isEnd,\n          isStart,\n          isEnd,\n          isToday: adapter.isSameDay(date, today),\n          isAdjacent,\n          isHidden: isAdjacent && !props.showAdjacentMonths,\n          inRange: isRange &&\n            !isSame &&\n            (isStart || isEnd || (validDates.length === 2 && adapter.isWithinRange(date, validDates as [any, any]))),\n          // isHovered: props.hoverDate === date,\n          // inHover: hoverRange.value && isWithinRange(date, hoverRange.value),\n          isHovered: false,\n          inHover: false,\n          localized: adapter.format(date, 'dayOfMonth'),\n        }\n      })\n    })\n\n    const weeks = computed(() => {\n      return weeksInMonth.value.map(week => {\n        return getWeek(adapter, week[0])\n      })\n    })\n\n    const { backgroundColorClasses, backgroundColorStyles } = useBackgroundColor(props, 'color')\n\n    function selectDate (date: any) {\n      let newModel = props.modelValue.slice()\n\n      if (props.multiple) {\n        if (isDragging.value && dragHandle.value != null) {\n          const otherIndex = (dragHandle.value + 1) % 2\n          const fn = otherIndex === 0 ? 'isBefore' : 'isAfter'\n          if (adapter[fn](date, newModel[otherIndex])) {\n            newModel[dragHandle.value] = newModel[otherIndex]\n            newModel[otherIndex] = date\n            dragHandle.value = otherIndex\n          } else {\n            newModel[dragHandle.value] = date\n          }\n        } else {\n          if (newModel.find(d => adapter.isSameDay(d, date))) {\n            newModel = newModel.filter(v => !adapter.isSameDay(v, date))\n          } else if (newModel.length === 2) {\n            let index: number | undefined\n            if (!props.side || adapter.isSameMonth(newModel[0], newModel[1])) {\n              const closest = findClosestDate(date, newModel)\n              index = newModel.indexOf(closest)\n            } else {\n              index = props.side === 'start' ? 0 : props.side === 'end' ? 1 : undefined\n            }\n\n            newModel = newModel.map((v, i) => i === index ? date : v)\n          } else {\n            if (newModel[0] && adapter.isBefore(newModel[0], date)) {\n              newModel = [newModel[0], date]\n            } else {\n              newModel = [date, newModel[0]]\n            }\n          }\n        }\n      } else {\n        newModel = [date]\n      }\n\n      emit('update:modelValue', newModel.filter(v => !!v))\n    }\n\n    const daysRef = ref()\n\n    function findElement (el: HTMLElement | null): any {\n      if (!el || el === daysRef.value) return null\n\n      if ('vDate' in el.dataset) {\n        return adapter.date(el.dataset.vDate)\n      }\n\n      return findElement(el.parentElement)\n    }\n\n    function findDate (e: MouseEvent | TouchEvent) {\n      const x = 'changedTouches' in e ? e.changedTouches[0]?.clientX : e.clientX\n      const y = 'changedTouches' in e ? e.changedTouches[0]?.clientY : e.clientY\n      const el = document.elementFromPoint(x, y) as HTMLElement\n\n      return findElement(el)\n    }\n\n    let canDrag = false\n    function handleMousedown (e: MouseEvent | TouchEvent) {\n      hasScrolled.value = false\n\n      const selected = findDate(e)\n\n      if (!selected) return\n\n      const modelIndex = props.modelValue.findIndex(d => adapter.isEqual(d, selected))\n\n      if (modelIndex >= 0) {\n        canDrag = true\n        dragHandle.value = modelIndex\n\n        window.addEventListener('touchmove', handleTouchmove, { passive: false })\n        window.addEventListener('mousemove', handleTouchmove, { passive: false })\n\n        e.preventDefault()\n      }\n\n      window.addEventListener('touchend', handleTouchend, { passive: false })\n      window.addEventListener('mouseup', handleTouchend, { passive: false })\n    }\n\n    function handleTouchmove (e: MouseEvent | TouchEvent) {\n      if (!canDrag) return\n\n      e.preventDefault()\n\n      isDragging.value = true\n\n      const over = findDate(e)\n\n      if (!over) return\n\n      selectDate(over)\n    }\n\n    function handleTouchend (e: MouseEvent | TouchEvent) {\n      if (e.cancelable) e.preventDefault()\n\n      window.removeEventListener('touchmove', handleTouchmove)\n      window.removeEventListener('mousemove', handleTouchmove)\n      window.removeEventListener('touchend', handleTouchend)\n      window.removeEventListener('mouseup', handleTouchend)\n\n      const end = findDate(e)\n\n      if (!end) return\n\n      if (!hasScrolled.value) {\n        selectDate(end)\n      }\n\n      isDragging.value = false\n      dragHandle.value = null\n      canDrag = false\n    }\n\n    return () => (\n      <div class=\"v-date-picker-month\">\n        { props.showWeek && (\n          <div key=\"weeks\" class=\"v-date-picker-month__weeks\">\n            { !props.hideWeekdays && (\n              <div key=\"hide-week-days\" class=\"v-date-picker-month__day\">&nbsp;</div>\n            )}\n            { weeks.value.map(week => (\n              <div\n                class={[\n                  'v-date-picker-month__day',\n                  'v-date-picker-month__day--adjacent',\n                ]}\n              >{ week }</div>\n            ))}\n          </div>\n        )}\n\n        <div\n          ref={ daysRef }\n          class=\"v-date-picker-month__days\"\n          onMousedown={ handleMousedown }\n          onTouchstart={ handleMousedown }\n        >\n          { !props.hideWeekdays && adapter.getWeekdays().map(weekDay => (\n            <div\n              class={[\n                'v-date-picker-month__day',\n                'v-date-picker-month__weekday',\n              ]}\n            >{ weekDay }</div>\n          ))}\n\n          { daysInMonth.value.map((item, index) => {\n            const color = (item.isSelected || item.isToday)\n              ? props.color\n              : (item.isHovered || item.isDisabled)\n                ? undefined\n                : 'transparent'\n            const variant = item.isDisabled\n              ? 'text'\n              : (item.isToday || item.isHovered) && !item.isSelected\n                ? 'outlined'\n                : 'flat'\n\n            return (\n              <div\n                class={[\n                  'v-date-picker-month__day',\n                  {\n                    'v-date-picker-month__day--selected': item.isSelected,\n                    'v-date-picker-month__day--start': item.isStart,\n                    'v-date-picker-month__day--end': item.isEnd,\n                    'v-date-picker-month__day--adjacent': item.isAdjacent,\n                    'v-date-picker-month__day--hide-adjacent': item.isHidden,\n                    'v-date-picker-month__day--week-start': item.isWeekStart,\n                    'v-date-picker-month__day--week-end': item.isWeekEnd,\n                    'v-date-picker-month__day--hovered': item.isHovered,\n                  },\n                ]}\n                data-v-date={ !item.isHidden && !item.isDisabled ? item.isoDate : undefined }\n              >\n                { item.inRange && (\n                  <div\n                    key=\"in-range\"\n                    class={[\n                      'v-date-picker-month__day--range',\n                      backgroundColorClasses.value,\n                    ]}\n                    style={ backgroundColorStyles.value }\n                  />\n                )}\n\n                { item.inHover && !item.isStart && !item.isEnd && !item.isHovered && !item.inRange && (\n                  <div\n                    key=\"in-hover\"\n                    class=\"v-date-picker-month__day--hover\"\n                  />\n                )}\n\n                { (props.showAdjacentMonths || !item.isAdjacent) && (\n                  <VBtn\n                    active={ item.isSelected }\n                    color={ color }\n                    disabled={ item.isDisabled }\n                    icon\n                    ripple={ false } /* ripple not working correctly since we preventDefault in touchend */\n                    variant={ variant }\n                  >\n                    { item.localized }\n                  </VBtn>\n                )}\n              </div>\n            )\n          })}\n        </div>\n      </div>\n    )\n  },\n})\n\nexport type VDatePickerMonth = InstanceType<typeof VDatePickerMonth>\n"],"mappings":"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"}